import pytest
import requests
from traceroute.traceroute import validate_api_token


@pytest.fixture
def invalid_api_token():
    return "completely-invalid-api-token"


@pytest.fixture
def valid_api_token():
    return "completely-valid-api-token"


def test_api_token_validity(mocker, valid_api_token, invalid_api_token):
    successful_mock_response = mocker.Mock()
    successful_mock_response.status_code = 200

    failed_mock_response = mocker.Mock()
    failed_mock_response.status_code = 403

    def mock_get(url):
        if url.split("=")[-1] in [valid_api_token, ""]:
            return successful_mock_response

        return failed_mock_response

    mocker.patch("requests.get", mock_get)

    validate_api_token(valid_api_token)
    validate_api_token("")

    with pytest.raises(ValueError) as exception_information:
        validate_api_token(invalid_api_token)

    assert str(exception_information.value) == "Invalid API token!"
