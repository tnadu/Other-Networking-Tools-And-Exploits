from scapy.all import *
from flask import Flask, jsonify
from flask import request


import dns_settings


app = Flask(__name__)

@app.route('/')
def hello():
    return "Hello World!"

@app.route('/post', methods=['POST'])
def post_method():
    print("Got from user: ", request.get_json())
    requestedDomain = request.get_json()['value']

    # DNS request to your DNS server
    ip = IP(dst=dns_settings.DNS_CONTAINER_IP)
    transport = UDP(dport=dns_settings.UDP_PORT) 

    dns = DNS(rd=1)
    dns_query = DNSQR(qname=requestedDomain, qtype=1, qclass=1)
    dns.qd = dns_query

    answer = sr1(ip / transport / dns)

    return jsonify({'got_it': answer[DNS].summary()})

@app.route('/<name>')
def hello_name(name):
    return "Hello {}!".format(name)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8001)
